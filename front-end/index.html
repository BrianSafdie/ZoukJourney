<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zouk Journey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
</head>

<body>
  <div class="header-container">
    <p>Welcome to</p>
    <h1>Zouk Journey</h1>
  </div>
  
  <style>
    .buttons-container {
      display: none;
    }
  </style>

  <div class="buttons-container">
    <!-- <button id="load-btn">Load Dancers</button> -->
    <!-- <button id="next-page-btn">Go to About Page</button> -->
    <!-- <button id="third-page-btn">Go to Third Page</button> -->
    <button id="basic-step-btn">Start Learning The Basic Step</button>
  </div>

  <div id="g_id_onload"
    data-client_id="707475720698-omp6m2gnpm6huagif3gck0t78rm1roq6.apps.googleusercontent.com"
    data-callback="handleCredentialResponse"
    data-auto_prompt="false">
  </div>

  <div style="display: flex; justify-content: center; margin-top: 50px;">
    <div class="g_id_signin"
      data-type="standard"
      data-size="large"
      data-theme="outline"
      data-text="sign_in_with"
      data-shape="rectangular"
      data-logo_alignment="right"
      data-width="100">
    </div>
  </div>

  <ul id="dancer-list"></ul>

  <script>
    function handleCredentialResponse(response) {
      const jwt = response.credential;
      const payload = JSON.parse(atob(jwt.split('.')[1]));
      console.log("User info:", payload);
      // alert(`Welcome ${payload.name}!`);

      localStorage.setItem('token', jwt);
      localStorage.setItem('userName', payload.name);

      fetch('https://zoukjourney-back-end.onrender.com/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: jwt })
      })
      .then(res => res.json())
      .then(data => {
        console.log("Login response:", data);
      })
      .catch(err => {
        console.error("Login error:", err);
      });

      updateUIAfterLogin(payload.name);
    }

    window.onload = function() {
      const token = localStorage.getItem('token');
      const userName = localStorage.getItem('userName');

      if (token && userName) {
        console.log(`User ${userName} is already logged in.`);
        updateUIAfterLogin(userName);
      }
    };

    function updateUIAfterLogin(userName) {
      const googleButton = document.querySelector('.g_id_signin');
      if (googleButton) googleButton.style.display = 'none';

      let welcomeDiv = document.getElementById('welcome-message');
      if (!welcomeDiv) {
        welcomeDiv = document.createElement('div');
        welcomeDiv.id = 'welcome-message';
        document.body.insertBefore(welcomeDiv, document.body.firstChild);
      }
      welcomeDiv.textContent = `Hi, ${userName}!`;

      let logoutBtn = document.getElementById('logout-btn');
      if (!logoutBtn) {
        logoutBtn = document.createElement('button');
        logoutBtn.id = 'logout-btn';
        logoutBtn.textContent = 'Logout';
        welcomeDiv.after(logoutBtn);
        logoutBtn.addEventListener('click', logout);
        const buttonsContainer = document.querySelector('.buttons-container');
        if (buttonsContainer) buttonsContainer.style.display = 'block';
      }
    }

    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('userName');

      const googleButton = document.querySelector('.g_id_signin');
      if (googleButton) googleButton.style.display = 'block';

      const welcomeDiv = document.getElementById('welcome-message');
      if (welcomeDiv) welcomeDiv.remove();
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) logoutBtn.remove();
      const buttonsContainer = document.querySelector('.buttons-container');
      if (buttonsContainer) buttonsContainer.style.display = 'none';
    }

    function loadDancers() {
      fetch('https://zoukjourney-back-end.onrender.com/api/dancers')
        .then(response => response.json())
        .then(data => {
          const list = document.getElementById('dancer-list');
          list.innerHTML = '';
          data.forEach(dancer => {
            const li = document.createElement('li');
            li.textContent = `${dancer.name} - ${dancer.level}`;
            list.appendChild(li);
          });
        })
        .catch(error => console.error('Error loading dancers:', error));
    }

    // document.getElementById('load-btn').addEventListener('click', loadDancers);

    // document.getElementById('next-page-btn').addEventListener('click', () => {
    //   window.location.href = 'about.html';
    // });
    
    document.getElementById('basic-step-btn').addEventListener('click', () => {
      window.location.href = 'basic-step.html';
    });
    
    // document.getElementById('third-page-btn').addEventListener('click', () => {
    //   window.location.href = 'third.html';
    // });

  </script>
</body>
</html>